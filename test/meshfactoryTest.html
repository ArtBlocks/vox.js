<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
</head>
<body>

<canvas id="c" width="500" height="500"></canvas>

<script src="https://cdn.rawgit.com/mrdoob/three.js/r71/build/three.min.js"></script>
<script src="../build/vox.js"></script>
<script>

window.onload = function() {
    var scene = new THREE.Scene();
    var camera = new THREE.PerspectiveCamera(70, 1, 0.1, 1000);
    camera.position.y = 10;
    camera.position.z = 30;
    var directionalLight = new THREE.DirectionalLight(0xffffff);
    directionalLight.position.x = 0.5;
    directionalLight.position.y = 0.5;
    directionalLight.position.z = 0.5;
    scene.add(directionalLight);
    var ambientLight = new THREE.AmbientLight(0x999999);
    scene.add(ambientLight);
    
    var renderer = new THREE.WebGLRenderer({
        canvas: document.getElementById("c")
    });
    renderer.setSize(500, 500);

    var parser = new vox.Parser();
    parser.parse("./p10.vox", function(error, data) {
        var factory = new vox.MeshFactory(data, 1.2);
        var mesh = factory.getMesh();
        
        updateListeners.push(function() {
            mesh.rotation.y += 0.01;
        });
        
        scene.add(mesh);
        render();
    });
    
    var updateListeners = [];
    var update = function() {
        updateListeners.forEach(function(l){ l() });
    };
    
    var render = function() {
        update();
        renderer.render(scene, camera);
        requestAnimationFrame(render);
    };
};
</script>

</body>
</html>