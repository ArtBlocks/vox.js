<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
</head>
<body>

<canvas id="c" width="1000" height="1000"></canvas>

<script src="https://cdn.rawgit.com/mrdoob/three.js/r71/build/three.min.js"></script>
<script src="../build/vox.js"></script>
<script>

window.onload = function() {
    var scene = new THREE.Scene();
    var camera = new THREE.PerspectiveCamera(70, 1, 0.1, 1000);
    camera.position.y = 10;
    camera.position.z = 20;
    var dLight = new THREE.DirectionalLight(0xffffff);
    dLight.position.x = 0.5;
    dLight.position.y = 0.5;
    dLight.position.z = 0.5;
    scene.add(dLight);
    var aLight = new THREE.AmbientLight(0x999999);
    scene.add(aLight);

    var renderer = new THREE.WebGLRenderer({
        canvas: document.getElementById("c")
    });
    renderer.setSize(1000, 1000);

    var parser = new vox.Parser();
    parser.parse("./p10.vox", function(error, data) {
        var factory = new vox.MeshFactory(data, 1.2);
        var mesh = factory.createMesh();
        scene.add(mesh);
        render();

        updateListeners.push(function() {
            // mesh.rotation.x += 0.01;
            mesh.rotation.y += 0.02;
        });
    });

    var updateListeners = [];
    var update = function() {
        updateListeners.forEach(function(l){ l() });
    };

    var render = function() {
        update();
        renderer.render(scene, camera);
        requestAnimationFrame(render);
    };
};
</script>

</body>
</html>